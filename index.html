<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="Ú©Ø§Ù†ÙÛŒÚ¯ Ø§Ø³Ú©Ù†Ø± Ú©Ù„Ø§Ø¯ÙÙ„ÛŒØ±" />
    <meta property="og:description" content="Ø³Ø§Ø®Øª Ú©Ø§Ù†ÙÛŒÚ¯ Ø³ÙØ§Ø±Ø´ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø³Ú©Ù†Ø± Ú©Ù„Ø§Ø¯ÙÙ„ÛŒØ± Ù…Ø±ØªØ¶ÛŒ - Ù†Ø³Ø®Ù‡ ÙˆÛŒÙ†Ø¯ÙˆØ²" />
    <meta property="og:image" content="https://github.com/Surfboardv2ray/CFScanner-CCG/blob/main/assets/html.jpg?raw=true" />
    <meta property="og:url" content="https://https://github.com/Surfboardv2ray/CFScanner-CCG" />
    <title>Ú©Ø§Ù†ÙÛŒÚ¯ Ø§Ø³Ú©Ù†Ø± Ù…Ø±ØªØ¶ÛŒ</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font/dist/font-face.css">
    <style>
        body {
            font-family: 'Vazir', sans-serif;
            background-color: #fff;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
        }
        .container {
            background: linear-gradient(145deg, #e3e3e3, #ffffff);
            box-shadow: 5px 5px 10px #ccc, -5px -5px 10px #fff;
            border-radius: 15px;
            padding: 20px;
            max-width: 500px;
            width: 90%;
            text-align: center;
        }
        .input-box, .result-box, .dropdown, .submit-btn {
            margin: 20px 0;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 10px;
            font-size: 18px;
            width: 100%;
            box-shadow: inset 3px 3px 5px #b3b3b3, inset -3px -3px 5px #fff;
        }
        .input-box {
            resize: none;
            overflow-wrap: break-word;
            word-wrap: break-word;
            white-space: pre-wrap;
        }
        .input-box, .result-box {
            margin: 20px -10px;
        }
        .submit-btn {
            background-color: #ff8500;
            color: white;
            font-family: 'Vazir', sans-serif;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        .submit-btn:hover {
            background-color: #ff9800;
        }
        .result-box {
            min-height: 100px;
            background-color: #f7f7f7;
            overflow: auto;
            text-align: left;
            position: relative;
            direction: ltr;
        }
        .result-box pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            margin: 0;
            font-family: Consolas, "Courier New", monospace;
            direction: ltr;
        }
        .icon {
            position: absolute;
            top: 10px;
            cursor: pointer;
            font-size: 20px;
        }
        .save-icon {
            right: 10px;
        .footer {
            margin-top: 20px;
            color: grey;
            text-align: center;
        }
        .footer a {
            margin: 0 10px;
            color: #ff8500;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Ú©Ø§Ù†ÙÛŒÚ¯ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:</h2>
        <textarea class="input-box" id="configInput" placeholder="Ú©Ø§Ù†ÙÛŒÚ¯ Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..."></textarea>

        <h3>Ù†ÙˆØ¹ Ú©Ø§Ù†ÙÛŒÚ¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:</h3>
        <select class="dropdown" id="configType">
            <option value="vmess">vmess+ws+tls</option>
            <option value="vless">vless+ws+tls</option>
            <option value="trojan">trojan+ws+tls</option>
        </select>

        <button class="submit-btn" onclick="convertConfig()">ØªØ¨Ø¯ÛŒÙ„ Ú©Ø§Ù†ÙÛŒÚ¯</button>

        <h4>Ú©Ø§Ù†ÙÛŒÚ¯ Ø§Ø³Ú©Ù†Ø± Ù…Ø±ØªØ¶ÛŒ:</h4>
        <div class="result-box" id="resultBox">
            <pre id="resultText"></pre>
            <span class="icon save-icon" onclick="saveToFile()">ğŸ’¾</span>
        </div>

        <div class="footer">
            <a href="https://t.me/Surfboardv2ray">Ú©Ø§Ù†Ø§Ù„ ØªÙ„Ú¯Ø±Ø§Ù…</a> | 
            <a href="https://github.com/Surfboardv2ray/CFScanner-CCG">Ú¯ÛŒØªâ€ŒÙ‡Ø§Ø¨</a>
            <p>Surfboardv2ray, 2024</p>
        </div>
    </div>

    <script>
        function isBase64(str) {
            try {
                return btoa(atob(str)) === str;
            } catch (err) {
                return false;
            }
        }
        function convertConfig() {
            const configInput = document.getElementById("configInput").value.trim();
            const configType = document.getElementById("configType").value;
            const resultBox = document.getElementById("resultText");
            resultBox.innerHTML = "";  // Clear previous result

            try {
                let outputJson = "";

                if (configType === "vmess") {
                    if (!configInput.startsWith("vmess://")) throw "Ù„Ø·ÙØ§ ÛŒÚ© Ú©Ø§Ù†ÙÛŒÚ¯ vmess ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯";
                    const base64Content = configInput.slice(8);
                    let decodedConfig;
                    
                    try {
                        decodedConfig = JSON.parse(atob(base64Content));
                    } catch (e) {
                        throw "Ù„Ø·ÙØ§ ÛŒÚ© Ú©Ø§Ù†ÙÛŒÚ¯ vmess Ø¨Ø§ ÙØ±Ù…Øª ØµØ­ÛŒØ­ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯";
                    }

                    const { path, host, sni, id, port } = decodedConfig;
                    if (!path || !host || !sni || !id || !port) throw "Ú©Ø§Ù†ÙÛŒÚ¯ vmess Ø¨Ø§ Ø³Ø§Ø®ØªØ§Ø± Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø´Ø¯Ù‡ Ù…Ø·Ø§Ø¨Ù‚Øª Ù†Ø¯Ø§Ø±Ø¯";

                    outputJson = `{
  "inbounds": [{
    "port": "PORTPORT", 
    "listen": "127.0.0.1",
    "tag": "socks-inbound",
    "protocol": "socks",
    "settings": {
      "auth": "noauth",
      "udp": false,
      "ip": "127.0.0.1"
    },
    "sniffing": {
      "enabled": true,
      "destOverride": ["http", "tls"]
    }
  }],
  "outbounds": [
    {
    "protocol": "vmess",
    "settings": {
      "vnext": [{
        "address": "IP.IP.IP.IP", 
        "port": ${port},
        "users": [{"id": "${id}" }]
      }]
    },
		"streamSettings": {
        "network": "ws",
        "security": "tls",
        "wsSettings": {
            "headers": {
                "Host": "${host}"
            },
            "path": "${path}"
        },
        "tlsSettings": {
            "serverName": "${sni}",
            "allowInsecure": false,
			"fingerprint": "chrome",
			"alpn": [
			"http/1.1"
			]
        }
    }
	}],
  "other": {}
}`;

                } else if (configType === "vless") {

    // Get the config input without converting to lowercase
    const configInput = document.getElementById("configInput").value.trim();
    if (!configInput.startsWith("vless://")) {
          throw "Ù„Ø·ÙØ§ ÛŒÚ© Ú©Ø§Ù†ÙÛŒÚ¯ vless ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯";
    }
    // Step 1: Check for 'security=tls' (case-insensitively)
    if (!configInput.toLowerCase().includes("security=tls")) throw "Ù„Ø·ÙØ§ ÛŒÚ© Ú©Ø§Ù†ÙÛŒÚ¯ vless Ø¨Ø§ Ø³Ø§Ø®ØªØ§Ø± Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯";

    // Step 2: Check for 'sni=' (case-insensitively)
    if (!configInput.toLowerCase().includes("sni=")) throw "Ú©Ø§Ù†ÙÛŒÚ¯ Ø¨Ø§ÛŒØ¯ sni Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯";

    // Parsing the config URL
    const urlParts = configInput.slice(9).split('@');
    const id = urlParts[0]; // Extract the id before the '@'

    const hostPortPath = urlParts[1].split('?')[0]; // Get everything before '?'
    const lastColonIndex = hostPortPath.lastIndexOf(':');
    const host = hostPortPath.slice(0, lastColonIndex);
    const port = hostPortPath.slice(lastColonIndex + 1);


    const queryParams = new URLSearchParams(urlParts[1].split('?')[1]);

    // Step 4: Extract the "host" value until '&'
    const hostValue = queryParams.get("host")?.split('&')[0] || '';
    if (!hostValue) throw "Ú©Ø§Ù†ÙÛŒÚ¯ trojan Ø¨Ø§ Ø³Ø§Ø®ØªØ§Ø± Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø´Ø¯Ù‡ Ù…Ø·Ø§Ø¨Ù‚Øª Ù†Ø¯Ø§Ø±Ø¯";

    // Step 5: Extract the "sni" value until '&'
    const sniValue = queryParams.get("sni")?.split('&')[0] || '';

    // Ensure id and port are valid
    if (!id || !port) throw "Ú©Ø§Ù†ÙÛŒÚ¯ trojan Ø¨Ø§ Ø³Ø§Ø®ØªØ§Ø± Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø´Ø¯Ù‡ Ù…Ø·Ø§Ø¨Ù‚Øª Ù†Ø¯Ø§Ø±Ø¯";

    // Step 6: Check the 'allowInsecure' parameter
    const allowInsecureParam = queryParams.get("allowInsecure");
    const allowInsecure = allowInsecureParam === '1'; 

    outputJson = `{
      "inbounds": [{
        "port": "PORTPORT", 
        "listen": "127.0.0.1",
        "tag": "socks-inbound",
        "protocol": "socks",
        "settings": {
          "auth": "noauth",
          "udp": false,
          "ip": "127.0.0.1"
        },
        "sniffing": {
          "enabled": true,
          "destOverride": ["http", "tls"]
        }
      }],
      "outbounds": [
        {
          "tag": "proxy",
          "protocol": "vless",
          "settings": {
            "vnext": [{
              "address": "IP.IP.IP.IP", 
              "port": ${port},
              "users": [{"id": "${id}", "encryption": "none"}]
            }]
          },
          "streamSettings": {
            "network": "ws",
            "security": "tls",
            "tlsSettings": {
              "allowInsecure": ${allowInsecure},
              "serverName": "${sniValue}",
              "alpn": ["http/1.1"],
              "fingerprint": "chrome"
            },
            "wsSettings": {
              "path": "${queryParams.get("path")?.split('#')[0] || ''}",
              "headers": {
                "Host": "${hostValue}"
              }
            }
          }
        }
      ],
      "other": {}
    }`;

                } else if (configType === "trojan") {

    // Get the config input without converting to lowercase
    const configInput = document.getElementById("configInput").value.trim();
    if (!configInput.startsWith("trojan://")) {
          throw "Ù„Ø·ÙØ§ ÛŒÚ© Ú©Ø§Ù†ÙÛŒÚ¯ trojan ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯";
    }
    // Step 1: Check for 'security=tls' (case-insensitively)
    if (!configInput.toLowerCase().includes("security=tls")) throw "Ù„Ø·ÙØ§ ÛŒÚ© Ú©Ø§Ù†ÙÛŒÚ¯ trojan Ø¨Ø§ Ø³Ø§Ø®ØªØ§Ø± Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯";

    // Step 2: Check for 'sni=' (case-insensitively)
    if (!configInput.toLowerCase().includes("sni=")) throw "Ú©Ø§Ù†ÙÛŒÚ¯ Ø¨Ø§ÛŒØ¯ sni Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯";

    // Parsing the config URL
    const urlParts = configInput.slice(9).split('@');
    const id = urlParts[0]; // Extract the id before the '@'

    const hostPortPath = urlParts[1].split('?')[0]; // Get everything before '?'
    const lastColonIndex = hostPortPath.lastIndexOf(':');
    const host = hostPortPath.slice(0, lastColonIndex);
    const port = hostPortPath.slice(lastColonIndex + 1);


    const queryParams = new URLSearchParams(urlParts[1].split('?')[1]);

    // Step 4: Extract the "host" value until '&'
    const hostValue = queryParams.get("host")?.split('&')[0] || '';
    if (!hostValue) throw "Ú©Ø§Ù†ÙÛŒÚ¯ trojan Ø¨Ø§ Ø³Ø§Ø®ØªØ§Ø± Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø´Ø¯Ù‡ Ù…Ø·Ø§Ø¨Ù‚Øª Ù†Ø¯Ø§Ø±Ø¯";

    // Step 5: Extract the "sni" value until '&'
    const sniValue = queryParams.get("sni")?.split('&')[0] || '';

    // Ensure id and port are valid
    if (!id || !port) throw "Ú©Ø§Ù†ÙÛŒÚ¯ trojan Ø¨Ø§ Ø³Ø§Ø®ØªØ§Ø± Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø´Ø¯Ù‡ Ù…Ø·Ø§Ø¨Ù‚Øª Ù†Ø¯Ø§Ø±Ø¯";

    // Step 6: Check the 'allowInsecure' parameter
    const allowInsecureParam = queryParams.get("allowInsecure");
    const allowInsecure = allowInsecureParam === '1'; 
			
    outputJson = `{
        "inbounds": [{
            "port": "PORTPORT", 
            "listen": "127.0.0.1",
            "tag": "socks-inbound",
            "protocol": "socks",
            "settings": {
                "auth": "noauth",
                "udp": false,
                "ip": "127.0.0.1"
            },
            "sniffing": {
                "enabled": true,
                "destOverride": ["http", "tls"]
            }
        }],
        "outbounds": [
            {
                "tag": "proxy",
                "protocol": "trojan",
                "settings": {
                    "servers": [
                        {
                            "address": "IP.IP.IP.IP",
                            "method": "chacha20",
                            "ota": false,
                            "password": id,
                            "port": parseInt(port, 10),
                            "level": 1,
                            "flow": ""
                        }
                    ]
                },
                "streamSettings": {
                    "network": "ws",
                    "security": "tls",
                    "tlsSettings": {
                        "allowInsecure": allowInsecure,
                        "serverName": sniValue,
                        "alpn": ["http/1.1"],
                        "fingerprint": "chrome"
                    },
                    "wsSettings": {
                        "path": "${queryParams.get("path")?.split('#')[0] || ''}"',
                        "headers": {
                            "Host": hostValue
                        }
                    }
                },
                "mux": {
                    "enabled": false,
                    "concurrency": -1
                }
            }
        ],
        "other": {}
    }`;
}
 else {
                    throw "Ù†ÙˆØ¹ Ú©Ø§Ù†ÙÛŒÚ¯ Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡ Ø§Ø³Øª";
                }

                resultBox.innerHTML = outputJson;

            } catch (error) {
                resultBox.innerHTML = `<span style="color: red;">${error}</span>`;
            }
        }
	    
        function saveToFile() {
            const resultText = document.getElementById("resultText").innerText;
            if (!resultText) {
                alert("Ù‡ÛŒÚ† Ù…Ø­ØªÙˆØ§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯!");
                return;
            }

            const blob = new Blob([resultText], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "config.json";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
